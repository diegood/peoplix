#!/bin/sh

cd "$(git rev-parse --show-toplevel)"

echo "ðŸ“¦ Checking for changes to bump version..."

STAGED_FILES=$(git diff --cached --name-only)

# Backend
if echo "$STAGED_FILES" | grep -q "^backend/"; then
  if [ -f "backend/package.json" ]; then
    echo "ðŸ”¹ Backend changes detected. Bumping version..."
    cd backend
    npm version patch --no-git-tag-version
    git add package.json
    cd ..
  fi
else
  echo "ðŸ”¸ No backend changes detected. Skipping version bump."
fi

# Frontend
if echo "$STAGED_FILES" | grep -q "^frontend/"; then
  if [ -f "frontend/package.json" ]; then
    echo "ðŸ”¹ Frontend changes detected. Bumping version..."
    cd frontend
    npm version patch --no-git-tag-version
    git add package.json
    cd ..
  fi
else
  echo "ðŸ”¸ No frontend changes detected. Skipping version bump."
fi

echo "ðŸŽ‰ Version check completed."
